<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Mysql主从复制及读写分离的实现-MyCat | Mr-wang的博客 | 运维笔记</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一、MyCat介绍1、什么是MyCat
一个彻底开源的，面向企业应用开发的大数据库集群
支持事务、ACID、可以替代MySQL的加强版数据库
一个可以视为MySQL集群的企业级数据库，用来替代昂贵的Oracle集群
一个融合内存缓存技术、NoSQL技术、HDFS大数据的新型SQL Server
结合传统数据库和新型分布式数据仓库的新一代企业级数据库产品
一个新颖的数据库中间件产品

MyCat官网">
<meta property="og:type" content="article">
<meta property="og:title" content="Mysql主从复制及读写分离的实现-MyCat">
<meta property="og:url" content="http://www.mr-wang.cn/2016/03/10/Mysql-Master-slave-Read-Write-Splitting-MyCat/index.html">
<meta property="og:site_name" content="Mr-wang的博客 | 运维笔记">
<meta property="og:description" content="一、MyCat介绍1、什么是MyCat
一个彻底开源的，面向企业应用开发的大数据库集群
支持事务、ACID、可以替代MySQL的加强版数据库
一个可以视为MySQL集群的企业级数据库，用来替代昂贵的Oracle集群
一个融合内存缓存技术、NoSQL技术、HDFS大数据的新型SQL Server
结合传统数据库和新型分布式数据仓库的新一代企业级数据库产品
一个新颖的数据库中间件产品

MyCat官网">
<meta property="og:updated_time" content="2016-03-23T09:19:11.115Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mysql主从复制及读写分离的实现-MyCat">
<meta name="twitter:description" content="一、MyCat介绍1、什么是MyCat
一个彻底开源的，面向企业应用开发的大数据库集群
支持事务、ACID、可以替代MySQL的加强版数据库
一个可以视为MySQL集群的企业级数据库，用来替代昂贵的Oracle集群
一个融合内存缓存技术、NoSQL技术、HDFS大数据的新型SQL Server
结合传统数据库和新型分布式数据仓库的新一代企业级数据库产品
一个新颖的数据库中间件产品

MyCat官网">
  
    <link rel="alternative" href="/atom.xml" title="Mr-wang的博客 | 运维笔记" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://mr-wang.qiniudn.com/mr_wang.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Mr-wang</a></h1>
		</hgroup>

		
		<p class="header-subtitle">运维笔记</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/categories/技术">技术</a></li>
				        
							<li><a href="/categories/资源">资源</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="/#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/xiaowang0624" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Database/" style="font-size: 13.33px;">Database</a> <a href="/tags/Iptables/" style="font-size: 10px;">Iptables</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/Nginx/" style="font-size: 16.67px;">Nginx</a> <a href="/tags/Oracle/" style="font-size: 10px;">Oracle</a> <a href="/tags/vsftp-ftp/" style="font-size: 10px;">vsftp,ftp</a> <a href="/tags/网络/" style="font-size: 10px;">网络</a> <a href="/tags/通达OA/" style="font-size: 10px;">通达OA</a> <a href="/tags/阅读-书单/" style="font-size: 10px;">阅读,书单</a> <a href="/tags/集群/" style="font-size: 10px;">集群</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://mr-wang.qiniudn.com/UnixToolbox-zh_CN.html">Linux工具箱</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://linux.51yip.com/">Linux命令手册</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是Mr.wang，运维工程师一枚。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Mr-wang</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://mr-wang.qiniudn.com/mr_wang.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Mr-wang</h1>
			</hgroup>
			
			<p class="header-subtitle">运维笔记</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/categories/技术">技术</a></li>
		        
					<li><a href="/categories/资源">资源</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="/#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/xiaowang0624" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-Mysql-Master-slave-Read-Write-Splitting-MyCat" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/10/Mysql-Master-slave-Read-Write-Splitting-MyCat/" class="article-date">
  	<time datetime="2016-03-10T12:26:27.000Z" itemprop="datePublished">2016-03-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Mysql主从复制及读写分离的实现-MyCat
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Database/">Database</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/技术/">技术</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一、MyCat介绍">一、MyCat介绍</h1><h2 id="1、什么是MyCat">1、什么是MyCat</h2><ul>
<li>一个彻底开源的，面向企业应用开发的大数据库集群</li>
<li>支持事务、ACID、可以替代MySQL的加强版数据库</li>
<li>一个可以视为MySQL集群的企业级数据库，用来替代昂贵的Oracle集群</li>
<li>一个融合内存缓存技术、NoSQL技术、HDFS大数据的新型SQL Server</li>
<li>结合传统数据库和新型分布式数据仓库的新一代企业级数据库产品</li>
<li>一个新颖的数据库中间件产品</li>
</ul>
<p>MyCat官网：<a href="http://www.mycat.org.cn/" target="_blank" rel="external">http://www.mycat.org.cn/</a></p>
<h2 id="2、优势">2、优势</h2><p>copy官方的说明：<br>基于阿里开源的Cobar产品而研发，Cobar的稳定性、可靠性、优秀的架构和性能以及众多成熟的使用案例使得MYCAT一开始就拥有一个很好的起点，站在巨人的肩膀上，我们能看到更远。业界优秀的开源项目和创新思路被广泛融入到MYCAT的基因中，使得MYCAT在很多方面都领先于目前其他一些同类的开源项目，甚至超越某些商业产品。</p>
<p>MYCAT背后有一支强大的技术团队，其参与者都是5年以上资深软件工程师、架构师、DBA等，优秀的技术团队保证了MYCAT的产品质量。</p>
<p>MYCAT并不依托于任何一个商业公司，因此不像某些开源项目，将一些重要的特性封闭在其商业产品中，使得开源项目成了一个摆设（猜测是说的淘宝的TDDL，只开源动态数据源，分表分库部分还未开源）。</p>
<a id="more"></a>
<h1 id="二、Mysql主从配置">二、Mysql主从配置</h1><h2 id="1、环境介绍：">1、环境介绍：</h2><p>两台Mysql数据库实现主从配置<br>Mycat:172.16.14.1<br>Mysql Master:172.16.14.2<br>Mysql Slave:172.16.14.3</p>
<h2 id="2、在Master服务器上安装并配置Mysql">2、在Master服务器上安装并配置Mysql</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#23433;&#35013;Mysql&#24182;&#21152;&#20837;&#21040;&#31995;&#32479;&#26381;&#21153;&#10;[root@master ~]# tar xf mysql-5.6.13-linux-glibc2.5-x86_64.tar.gz -C /usr/local/&#10;[root@master ~]# cd /usr/local/&#10;[root@master local]# ln -s mysql-5.6.13-linux-glibc2.5-x86_64 mysql&#10;[root@master local]# cd mysql&#10;[root@master mysql]# cp support-files/mysql.server /etc/init.d/mysqld&#10;[root@master mysql]# chmod +x /etc/init.d/mysqld&#10;[root@master mysql]# chkconfig --add mysqld&#10;[root@master mysql]# echo &#34;PATH=/usr/local/mysql/bin:$PATH&#34; &#62;&#62; /etc/profile&#10;[root@master mysql]# . /etc/profile</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#25552;&#20379;&#20027;&#37197;&#32622;&#25991;&#20214;&#10;[root@master mysql]# vim /etc/my.cnf&#10;[client]&#10;#&#23450;&#20041;mysql client&#30340;&#23494;&#30721;&#10;#password       = your_password&#10;port            = 3306&#10;socket          = /tmp/mysql.sock&#10;[mysqld]&#10;port            = 3306&#10;socket          = /tmp/mysql.sock&#10;skip-external-locking&#10;key_buffer_size = 256M&#10;max_allowed_packet = 1M&#10;table_open_cache = 256&#10;sort_buffer_size = 1M&#10;read_buffer_size = 1M&#10;read_rnd_buffer_size = 4M&#10;myisam_sort_buffer_size = 64M&#10;thread_cache_size = 8&#10;query_cache_size= 16M&#10;thread_concurrency = 8&#10;binlog-format=ROW&#10;#&#24320;&#21551;GTID&#27169;&#24335;&#10;log-slave-updates=true&#10;gtid-mode=on&#10;enforce-gtid-consistency=true&#10;&#10;master-info-repository=TABLE&#10;relay-log-info-repository=TABLE&#10;sync-master-info=1&#10;slave-parallel-workers=2&#10;binlog-checksum=CRC32&#10;master-verify-checksum=1&#10;slave-sql-verify-checksum=1&#10;binlog-rows-query-log_events=1&#10;report-port=3306&#10;datadir=/data&#10;report-host=172.16.14.2&#10;log-bin=mysql-bin&#10;server-id       = 10&#10;[mysqldump]&#10;quick&#10;max_allowed_packet = 16M&#10;[mysql]&#10;no-auto-rehash&#10;[myisamchk]&#10;key_buffer_size = 128M&#10;sort_buffer_size = 128M&#10;read_buffer = 2M&#10;write_buffer = 2M&#10;[mysqlhotcopy]&#10;interactive-timeout</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#21021;&#22987;&#21270;Mysql&#10;[root@master mysql]# useradd -r mysql&#10;[root@master mysql]# mkdir /data&#10;[root@master mysql]# chown -R mysql.mysql /data&#10;[root@master mysql]# chown -R root.mysql /usr/local/mysql/*&#10;[root@master mysql]# ./scripts/mysql_install_db --user=mysql --datadir=/data/&#10;[root@master ~]# service mysqld start</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#22312;Slave&#26381;&#21153;&#22120;&#19978;&#23433;&#35013;Mysql&#19982;&#22312;Master&#26381;&#21153;&#22120;&#19978;&#23433;&#35013;&#26041;&#27861;&#30456;&#21516;&#65292;&#32780;&#22312;Slave&#26381;&#21153;&#22120;&#19978;&#23433;&#35013;Mysql&#26377;&#20004;&#20010;&#21442;&#25968;&#19982;Master&#26381;&#21153;&#22120;&#19981;&#21516;&#65307;&#22914;&#19979;&#10;server-id=11&#10;report-host=172.16.14.3&#10;[root@slave ~]# service mysqld start</span><br></pre></td></tr></table></figure>
<h2 id="3、在Master服务器上为Slave创建复制用户并测试连接">3、在Master服务器上为Slave创建复制用户并测试连接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mysql&#10;mysql&#62; grant replication slave,replication client on *.* to &#39;slave&#39;@&#39;172.16.%.%&#39; identified by &#39;passwd&#39;;&#10;mysql&#62; flush privileges;&#10;------------------------------------------------------------------------&#10;######&#27979;&#35797;&#36830;&#25509;&#10;[root@slave ~]# mysql -uslave -ppasswd -h 172.16.14.2</span><br></pre></td></tr></table></figure>
<h2 id="4、启动从节点的复制线程">4、启动从节点的复制线程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@slave ~]# mysql&#10;mysql&#62; change master to master_host=&#39;172.16.14.2&#39;,master_user=&#39;slave&#39;,master_password=&#39;passwd&#39;,master_auto_position=1;&#10;mysql&#62; start slave;&#10;mysql&#62; show slave status\G;&#10;*************************** 1. row ***************************&#10;               Slave_IO_State: Waiting for master to send event&#10;                  Master_Host: 172.16.14.2&#10;                  Master_User: slave&#10;                  Master_Port: 3306&#10;                Connect_Retry: 60&#10;              Master_Log_File: mysql-bin.000005&#10;          Read_Master_Log_Pos: 191&#10;               Relay_Log_File: slave-relay-bin.000003&#10;                Relay_Log_Pos: 401&#10;        Relay_Master_Log_File: mysql-bin.000005&#10;             Slave_IO_Running: Yes      #&#20027;&#35201;&#30475;&#36825;&#20004;&#39033;&#20026;&#8220;YES&#8221;&#35828;&#26126;&#25104;&#21151;&#10;            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure>
<h2 id="5、在Master服务器创建数据库查看Slave服务器是否更新">5、在Master服务器创建数据库查看Slave服务器是否更新</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mysql -e &#39;create database allen;&#39;&#10;------------------------------------------------------------------------&#10;[root@slave ~]# mysql -e &#39;show databases;&#39;&#10;+--------------------+&#10;| Database           |&#10;+--------------------+&#10;| information_schema |&#10;| allen              |&#10;| mysql              |&#10;| performance_schema |&#10;| test               |&#10;+--------------------+&#10;#&#30001;&#19978;&#21487;&#35265;&#65292;&#26032;&#21019;&#24314;&#30340;&#34;allen&#34;&#25968;&#25454;&#24211;&#24050;&#25104;&#21151;&#21516;&#27493;</span><br></pre></td></tr></table></figure>
<p>至此Mysql 5.6 基于GTID的复制已经完成，下面将介绍如何基于Mysql的主从复制架构做读写分离</p>
<h1 id="三、读写分离配置">三、读写分离配置</h1><p>基于前面做的Mysql主从架构，然后在前端加一台服务器，用于实现Mysql的读写分离，IP地址为：172.16.14.1；由于Mycat是java程序所研发，所以需要先安装JDK程序</p>
<h2 id="1、安装JDK">1、安装JDK</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@amoeba ~]# tar xzvf jdk-7u72-linux-x64.tar.gz&#10;[root@amoeba ~]# chown -R /usr/local/java&#10;[root@amoeba ~]# mv jdk1.7.0_72 /usr/local/java&#10;[root@amoeba ~]# vim /etc/profile&#10;export JAVA_HOME=/usr/local/java/jdk1.7.0_72&#10;export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar&#10;export PATH=$PATH:$JAVA_HOME/bin&#10;[root@amoeba ~]# source /etc/profile&#10;[root@amoeba ~]# java -version&#10;java version &#34;1.7.0_72&#34;&#10;Java(TM) SE Runtime Environment (build 1.7.0_72-b14)&#10;Java HotSpot(TM) 64-Bit Server VM (build 24.72-b04, mixed mode)</span><br></pre></td></tr></table></figure>
<h2 id="2、安装MyCat">2、安装MyCat</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@amoeba ~]# tar xzvf Mycat-server-1.5-RELEASE-20160309173032-linux.tar.gz &#10;[root@amoeba ~]# mv Mycat /usr/local/</span><br></pre></td></tr></table></figure>
<h2 id="3、授权Mysql用户，用于实现前端MyCat连接">3、授权Mysql用户，用于实现前端MyCat连接</h2><p>由于上面授权的主从复制帐号不能同步”mysql”数据库，所以用户名也无法同步，要在两台数据库上同时授权，用户名密码保持一致</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#20027;mysql&#10;[root@master ~]# mysql&#10;mysql&#62; grant all on *.* to &#39;mycat&#39;@&#39;172.16.%.%&#39; identified by &#39;123456&#39;;&#10;mysql&#62; flush privileges;&#10;&#10;#&#22791;mysql&#10;[root@slave ~]# mysql&#10;mysql&#62; grant all on *.* to &#39;mycat&#39;@&#39;172.16.%.%&#39; identified by &#39;123456&#39;;&#10;mysql&#62; flush privileges;</span><br></pre></td></tr></table></figure>
<h2 id="4、配置MyCat">4、配置MyCat</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mycat ~]# cd /usr/local/mycat/conf/  #&#20027;&#35201;&#37197;&#32622;&#25991;&#20214;&#20026;&#20197;&#19979;&#20004;&#20010;&#10;schema.xml        #&#23450;&#20041;&#25968;&#25454;&#24211;&#35835;&#20889;&#20998;&#31163;&#21450;&#33410;&#28857;&#31649;&#29702;&#20449;&#24687;&#31561;&#10;server.xml        #&#20445;&#23384;&#20102;&#25152;&#26377;mycat&#38656;&#35201;&#30340;&#31995;&#32479;&#37197;&#32622;&#20449;&#24687;,mycat&#26381;&#21153;&#29992;&#25143;&#23494;&#30721;&#31561;&#10;&#10;[root@mycat ~]# vi schema.xml&#10;&#60;?xml version=&#34;1.0&#34;?&#62;&#10;&#60;!DOCTYPE mycat:schema SYSTEM &#34;schema.dtd&#34;&#62;&#10;&#60;mycat:schema xmlns:mycat=&#34;http://org.opencloudb/&#34;&#62;&#10;&#10;&#60;!--schema&#26631;&#31614;&#29992;&#20110;&#23450;&#20041;MyCat&#23454;&#20363;&#20013;&#30340;&#36923;&#36753;&#24211;&#65292;MyCat&#21487;&#26377;&#22810;&#20010;&#36923;&#36753;&#24211;&#65292;&#27599;&#20010;&#36923;&#36753;&#24211;&#37117;&#26377;&#33258;&#24049;&#30340;&#30456;&#20851;&#37197;&#32622;&#12290;&#21487;&#20197;&#20351;&#29992; schema &#26631;&#31614;&#26469;&#21010;&#20998;&#19981;&#21516;&#30340;&#36923;&#36753;&#24211;&#12290;--&#62;&#10;&#60;!--&#36825;&#37324;&#23450;&#20041;&#19968;&#20010;TESTDB&#30340;&#36923;&#36753;&#24211;&#65292;&#21253;&#21547;dn1&#36825;&#20010;&#20998;&#29255; --&#62;&#10;&#9;&#60;schema name=&#34;TESTDB&#34; checkSQLschema=&#34;false&#34; sqlMaxLimit=&#34;100&#34; dataNode=&#34;dn1&#34;&#62;&#10;&#9;    &#60;!--&#21487;&#37197;&#32622;&#20998;&#29255;&#35268;&#21017;,user&#34920;&#26681;&#25454;latest-month-calldate&#35268;&#21017;&#20998;&#29255;&#21040;dn2,dn3&#33410;&#28857;&#65292;&#20854;&#20182;&#27809;&#23450;&#20041;&#30340;&#34920;&#40664;&#35748;&#22312;dn1&#33410;&#28857;--&#62; &#10;&#9;&#9;&#60;!-- auto sharding by id (long) --&#62;&#10;&#9;&#9;&#60;!-- &#60;table name=&#34;user&#34; primaryKey=&#34;ID&#34; dataNode=&#34;dn2&#65292;dn3&#34; rule=&#34;latest-month-calldate&#34; /&#62; --&#62;&#10;&#9;&#60;/schema&#62;&#10;&#9;&#10;&#9;&#60;!--&#23450;&#20041;&#25968;&#25454;&#20998;&#29255;&#33410;&#28857;&#65292;&#20351;&#29992;&#21517;&#23383;&#20026;localhost1&#24211;&#23454;&#20363;&#19978;&#30340;wytest&#29289;&#29702;&#25968;&#25454;&#24211;&#65292;&#23601;&#32452;&#25104;&#19968;&#20010;&#25968;&#25454;&#20998;&#29255;&#65292;&#21487;&#37197;&#32622;&#22810;&#20010; --&#62;&#10;&#9;&#60;dataNode name=&#34;dn1&#34; dataHost=&#34;localhost1&#34; database=&#34;wytest&#34; /&#62;&#10;&#9;&#60;!--&#60;dataNode name=&#34;dn4&#34; dataHost=&#34;sequoiadb1&#34; database=&#34;SAMPLE&#34; /&#62;&#10;&#9; &#60;dataNode name=&#34;jdbc_dn1&#34; dataHost=&#34;jdbchost&#34; database=&#34;db1&#34; /&#62; &#10;&#9;&#60;dataNode&#9;name=&#34;jdbc_dn2&#34; dataHost=&#34;jdbchost&#34; database=&#34;db2&#34; /&#62; &#10;&#9;&#60;dataNode name=&#34;jdbc_dn3&#34; &#9;dataHost=&#34;jdbchost&#34; database=&#34;db3&#34; /&#62; --&#62;&#10;&#9;&#10;&#9;&#60;!--&#23450;&#20041;&#20855;&#20307;&#30340;&#25968;&#25454;&#23454;&#20363;--&#62;&#10;&#9;&#60;!--balance &#36127;&#36733;&#22343;&#34913;&#31867;&#22411;&#65292;&#30446;&#21069;&#30340;&#21462;&#20540;&#26377; 3 &#31181;&#65306;&#10;     1. balance=&#34;0&#34;,&#19981;&#24320;&#21551;&#35835;&#20889;&#20998;&#31163;&#26426;&#21046;&#65292;&#25152;&#26377;&#35835;&#25805;&#20316;&#37117;&#21457;&#36865;&#21040;&#24403;&#21069;&#21487;&#29992;&#30340;writeHost&#19978;&#12290;&#10;     2. balance=&#34;1&#34;&#65292;&#20840;&#37096;&#30340;readHost&#19982;stand by writeHost&#21442;&#19982;select&#26597;&#35810;&#30340;&#36127;&#36733;&#22343;&#34913;&#65292;&#31616;&#21333;&#30340;&#35828;&#65292;&#24403;&#21452;&#20027;&#21452;&#20174;&#27169;&#24335;(M1-&#62;S1&#65292;M2-&#62;S2&#65292;&#24182;&#19988;M1&#19982;M2&#20114;&#20026;&#20027;&#22791;)&#65292;&#27491;&#24120;&#24773;&#20916;&#19979;&#65292;M2,S1,S2 &#37117;&#21442;&#19981; select &#26597;&#35810;&#30340;&#36127;&#36733;&#22343;&#34913;&#12290;&#10;     3. balance=&#34;2&#34;&#65292;&#25152;&#26377;&#35835;&#25805;&#20316;&#37117;&#38543;&#26426;&#30340;&#22312; writeHost&#12289;readhost &#19978;&#20998;&#21457;&#12290;&#10;     4. balance=&#34;3&#34;&#65292;&#25152;&#26377;&#35835;&#35831;&#27714;&#38543;&#26426;&#30340;&#20998;&#21457;&#21040;wiriterHost&#23545;&#24212;&#30340;readhost&#25191;&#34892;&#65292;writerHost&#19981;&#36127;&#25285;&#35835;&#21387;&#21147;&#65292;&#27880;&#24847; balance=3 &#21479;&#22312; 1.4 &#21450;&#20854;&#20197;&#21518;&#29256;&#26412;&#26377;&#65292;1.3 &#27809;&#26377;&#12290;--&#62;&#10;&#9;&#60;dataHost name=&#34;localhost1&#34; maxCon=&#34;1000&#34; minCon=&#34;10&#34; balance=&#34;1&#34;&#10;&#9;&#9;writeType=&#34;0&#34; dbType=&#34;mysql&#34; dbDriver=&#34;native&#34; switchType=&#34;1&#34;  slaveThreshold=&#34;100&#34;&#62;&#10;&#9;&#9;&#60;heartbeat&#62;select user()&#60;/heartbeat&#62;&#10;&#9;&#9;&#60;!-- can have multi write hosts --&#62;&#10;&#9;&#9;&#60;!--&#22312;&#19968;&#20010;dataHost&#20869;&#21487;&#23450;&#20041;&#22810;&#20010;writeHost&#21644;readHost&#12290;&#20294;&#26159;&#65292;&#22914;&#26524;writeHost&#25351;&#23450;&#30340;&#21518;&#31471;&#25968;&#25454;&#24211;&#23445;&#26426;&#65292;&#37027;&#20040;&#36825;&#20010;writeHost&#32465;&#23450;&#30340;&#25152;&#26377;readHost&#37117;&#23558;&#19981;&#21487;&#29992;&#12290;&#21478;&#19968;&#26041;&#38754;&#65292;&#30001;&#20110;&#36825;&#20010;writeHost&#23445;&#26426;&#65292;&#31995;&#32479;&#20250;&#33258;&#21160;&#30340;&#26816;&#27979;&#21040;&#65292;&#24182;&#20999;&#25442;&#21040;&#22791;&#29992;&#30340;writeHost&#19978;&#21435;--&#62;&#10;&#9;&#9;&#60;writeHost host=&#34;hostM1&#34; url=&#34;172.16.14.2:3306&#34; user=&#34;mycat&#34; password=&#34;123456&#34;&#62;&#10;&#9;&#9;&#60;!-- can have multi read hosts --&#62;&#10;        &#60;readHost host=&#34;hostS1&#34; url=&#34;172.16.14.3:3306&#34; user=&#34;mycat&#34; password=&#34;123456&#34; /&#62;&#10;&#9;&#9;&#60;/writeHost&#62;&#10;&#9;&#9;&#60;!-- &#60;writeHost host=&#34;hostM2&#34; url=&#34;localhost:3316&#34; user=&#34;root&#34; password=&#34;123456&#34;/&#62; --&#62;&#10;&#9;&#60;/dataHost&#62;&#10;&#60;/mycat:schema&#62;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@mycat ~]# vi server.xml&#10;&#60;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&#62;&#10;&#60;!DOCTYPE mycat:server SYSTEM &#34;server.dtd&#34;&#62;&#10;&#60;mycat:server xmlns:mycat=&#34;http://org.opencloudb/&#34;&#62;&#10;&#9;&#60;system&#62;&#10;&#9;&#60;property name=&#34;defaultSqlParser&#34;&#62;druidparser&#60;/property&#62;&#10;      &#60;!--  &#60;property name=&#34;useCompression&#34;&#62;1&#60;/property&#62;--&#62; &#60;!--1&#20026;&#24320;&#21551;mysql&#21387;&#32553;&#21327;&#35758;--&#62;&#10;&#9;&#60;!-- &#60;property name=&#34;processorBufferChunk&#34;&#62;40960&#60;/property&#62; --&#62;&#10;&#9;&#60;!-- &#10;&#9;&#60;property name=&#34;processors&#34;&#62;1&#60;/property&#62; &#10;&#9;&#60;property name=&#34;processorExecutor&#34;&#62;32&#60;/property&#62; &#10;&#9; --&#62;&#10;&#9;&#9;&#60;!--&#40664;&#35748;&#26159;65535 64K &#29992;&#20110;sql&#35299;&#26512;&#26102;&#26368;&#22823;&#25991;&#26412;&#38271;&#24230; --&#62;&#10;&#9;&#9;&#60;!--&#60;property name=&#34;maxStringLiteralLength&#34;&#62;65535&#60;/property&#62;--&#62;&#10;&#9;&#9;&#60;!--&#60;property name=&#34;sequnceHandlerType&#34;&#62;0&#60;/property&#62;--&#62;&#10;&#9;&#9;&#60;!--&#60;property name=&#34;backSocketNoDelay&#34;&#62;1&#60;/property&#62;--&#62;&#10;&#9;&#9;&#60;!--&#60;property name=&#34;frontSocketNoDelay&#34;&#62;1&#60;/property&#62;--&#62;&#10;&#9;&#9;&#60;!--&#60;property name=&#34;processorExecutor&#34;&#62;16&#60;/property&#62;--&#62;&#10;&#9;&#9;&#60;!-- &#10;&#9;&#9;&#9;&#60;property name=&#34;mutiNodeLimitType&#34;&#62;1&#60;/property&#62; 0&#65306;&#24320;&#21551;&#23567;&#25968;&#37327;&#32423;&#65288;&#40664;&#35748;&#65289; &#65307;1&#65306;&#24320;&#21551;&#20159;&#32423;&#25968;&#25454;&#25490;&#24207;&#10;&#9;    &#9;&#60;property name=&#34;mutiNodePatchSize&#34;&#62;100&#60;/property&#62; &#20159;&#32423;&#25968;&#37327;&#25490;&#24207;&#25209;&#37327;&#10;&#9;&#9;&#9;&#60;property name=&#34;processors&#34;&#62;32&#60;/property&#62;&#10;&#9;&#9;&#9;&#60;property name=&#34;processorExecutor&#34;&#62;32&#60;/property&#62; &#10;&#9;&#9;&#9;&#60;property name=&#34;serverPort&#34;&#62;8066&#60;/property&#62; &#10;&#9;&#9;&#9;&#60;property name=&#34;managerPort&#34;&#62;9066&#60;/property&#62; &#10;&#9;&#9;&#9;&#60;property name=&#34;idleTimeout&#34;&#62;300000&#60;/property&#62; &#10;&#9;&#9;&#9;&#60;property name=&#34;bindIp&#34;&#62;0.0.0.0&#60;/property&#62; &#10;&#9;&#9;&#9;&#60;property name=&#34;frontWriteQueueSize&#34;&#62;4096&#60;/property&#62; &#10;&#9;&#9;&#9;&#60;property name=&#34;processors&#34;&#62;32&#60;/property&#62; --&#62;&#10;&#9;&#60;/system&#62;&#10;&#9;&#10;&#9;&#60;!--&#23450;&#20041;test&#29992;&#25143;&#65292;&#35775;&#38382;TESTDB&#30340;&#36923;&#36753;&#24211;(schema.xml&#20013;&#23450;&#20041;)--&#62;&#10;&#9;&#60;user name=&#34;test&#34;&#62;&#10;&#9;&#9;&#60;property name=&#34;password&#34;&#62;test&#60;/property&#62;&#10;&#9;&#9;&#60;property name=&#34;schemas&#34;&#62;TESTDB&#60;/property&#62;&#10;&#9;&#60;/user&#62;&#10;&#10;&#9;&#60;user name=&#34;user&#34;&#62;&#10;&#9;&#9;&#60;property name=&#34;password&#34;&#62;user&#60;/property&#62;&#10;&#9;&#9;&#60;property name=&#34;schemas&#34;&#62;TESTDB&#60;/property&#62;&#10;&#9;&#9;&#60;property name=&#34;readOnly&#34;&#62;true&#60;/property&#62;&#10;&#9;&#60;/user&#62;&#10;&#9;&#10;&#9;&#60;!-- &#10;&#9;&#60;quarantine&#62; &#10;&#9;   &#60;whitehost&#62;&#10;&#9;      &#60;host host=&#34;127.0.0.1&#34; user=&#34;mycat&#34;/&#62;&#10;&#9;      &#60;host host=&#34;127.0.0.2&#34; user=&#34;mycat&#34;/&#62;&#10;&#9;   &#60;/whitehost&#62;&#10;       &#60;blacklist check=&#34;false&#34;&#62;&#60;/blacklist&#62;&#10;&#9;&#60;/quarantine&#62;&#10;&#9;--&#62;&#10;&#60;/mycat:server&#62;</span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/03/05/Mysql-Master-slave-Read-Write-Splitting-Amoeba/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Mysql主从复制及读写分离的实现-Amoeba</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="Mysql-Master-slave-Read-Write-Splitting-MyCat" data-title="Mysql主从复制及读写分离的实现-MyCat" data-url="http://www.mr-wang.cn/2016/03/10/Mysql-Master-slave-Read-Write-Splitting-MyCat/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"Mr-wang"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Mr-wang
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>